image: Visual Studio 2017

version: '0.4.{build}'

configuration:
- Debug
- Release

platform: x86

environment:
    matrix:
        # - TOOLCHAIN: msvc14
        - TOOLCHAIN: msvc15
    private_key:
        secure: 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        

install:
    - call CI\appveyor\install.bat %TOOLCHAIN% %PLATFORM%
    - ps: $fileContent = "-----BEGIN OPENSSH PRIVATE KEY-----`n"
    - ps: $fileContent += $env:private_key.Replace(' ', "`n")
    - ps: $fileContent += "`n-----END OPENSSH PRIVATE KEY-----`n"
    - ps: Set-Content $env:userprofile\.ssh\id_rsa $fileContent


build_script:
    - cd build
    - set TDE2_SKIP_ERROR_WAIT_USER_RESPONSE=1 # Skip pause when error's happened
    - call prepare_build_generic_win.bat %CMAKE_CONFIGURE_FLAGS% %CONFIGURATION%

test_script:
    - ctest -C %CONFIGURATION% --output-on-failure

artifacts:
    - path: .
      name: TDEngine2_SDK.zip

after_build:
    - cmd: 7z a TDEngine2_SDK.zip %APPVEYOR_BUILD_FOLDER%\bin\%CONFIGURATION%\ %APPVEYOR_BUILD_FOLDER%\Resources %APPVEYOR_BUILD_FOLDER%\README.md %APPVEYOR_BUILD_FOLDER%\LICENSE %APPVEYOR_BUILD_FOLDER%\CHANGELOG.md %APPVEYOR_BUILD_FOLDER%\TDEngine2\

skip_tags: true

deploy:
  release: TDEngine2_SDK-v$(appveyor_build_version)-Win32
  description: ''
  provider: GitHub
  auth_token:
    secure: GMrmiUbidhqUQJE6M8XWztU+5GhVHZyHkECQlzwYsnP2jB1ZxDxcMHnOq7aEa2vE
  artifact: /.*\.zip/            
  draft: false
  prerelease: false
  on:
    branch: master                 # release from master branch only
    #configuration: Release